### <a name="_b7urdng99y53"></a>**Название задачи:** 
MVP архитектуры "платформа управления животноводческим комплексом"
### <a name="_hjk0fkfyohdk"></a>**Автор:**
Бессолицын Антон
### <a name="_uanumrh8zrui"></a>**Дата:**
24.07.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**
Система должна:
|**№**|**Требование**|
| :-: | :- |
|1|фиксировать признаки беспокойного поведения или драк среди животных и оповещать оператора;
|2|фиксировать признаки задавливания поросят;
|3|управлять кормушками и поилками разных производителей;
|4|оценивать состояние животных по внешнему виду и поведению: болезнь, гибель, беспокойство и так далее;
|5|следить за состоянием систем фильтрации воды;
|6|пересчитывать поголовье;
|7|следить за запасами еды и прогнозировать расход;
|8|делать пересчёт животных;
|9|поддерживать необходимое количество видеокамер для аналитики в реальном времени от разных производителей;
|10|быть построена по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью);
|11|предоставлять базовые метрики для передачи в другие системы;
|12|поддерживать возможность добавления собственных метрик;
|13|работать даже в случае отсутствия интернета и при необходимости отправлять уведомления дежурному сотруднику на местах мониторинга, а после восстановления связи синхронизироваться с центральной системой;
|14|иметь разделение ролей и поддерживать современные способы аутентификации и авторизации;
|15|иметь API для создания мобильного приложения или веб-приложения.

Варианты использования системы пользователем
|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|1|Любой сотрудник животноводческого комплекса, платформа |Использует веб приложение платформы.  | 1. Пользователь авторизуется на платформе 2. Платформа предоставляет UI, в зависимости от его роли и прав доступа пользователь видит состояние систем, сводку о поголовье животных, оповещения, прогноз расхода корма и воды и другие метрики  |
|2|платформа, ИИ-система мониторинга животных| потоковая передача видеоданнын |1. Платформав режиме real-time передает видео в ИИ-систему. 2. ИИ - система анализирует поток | 3. Результаты анализа в виде потока сообщени отправляются в платформу|

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Система должна:
|**№**|**Требование**|
| :-: | :- |
|1|обеспечить достаточно высокую отказоустойчивость 99,95%;|
|2|возможность расширения, то есть иметь возможность разработать новый функционал без изменений существующего;|
|3|высокая производительность — от момента возникновения нештатной ситуации, зафиксированной с помощью видеоаналитики, должно проходить не более 5 секунд до момента оповещения;|
|4|Система видеоаналитики должна реагировать в реальном времени (миллисекунды).|
|5|Построить платформу по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью); |
### <a name="_qmphm5d6rvi3"></a>**Решение**
Данный документ является результатом поиска архитектурного решения согласно описанным требованиям.
Процесс принятия решения задокументирован в документах [ADR-C1](../TASK1/ADR-С1.md) и [ADR-C2](../TASK2/ADR-С2.md).
Рассмотренное альтернативное решение в диаграммах:
- [диаграмма контекста](../Task1/agrotech_v2_С1.puml) 
- [диаграмма контейнеров](../Task2/agrotech_v2_С2.puml) 
- [диаграмма компонентов](../Task3/agrotech_v2_С3.puml) 
- [диаграмма классов](../Task3/agrotech_v2_С4.puml) 

Основное решение
- [диаграмма контекста](../Task1/agrotech_v1_С1.puml) 
- [диаграмма контейнеров](../Task2/agrotech_v1_С1.puml) 
- [диаграмма компонентов](../Task3/agrotech_v1_С3.puml) 
- [диаграмма классов](../Task3/agrotech_v1_С4.puml) 

**Описание работы**

Система жизнеобеспечения животных - на физическом уровне это все технические системы обспечивающие жизнедеятельность животных. Это могут быть поилки, кормилки средства подачи корма, хранения, подготовки воды. Каждое такое  средство должно быть способно передать информацию о своем состояни. Для приема сообщений от технических устройств необходимо расположить несколько устройств сбора данных и одно устройство шлюз для унификации формата сообщений от устройств и передачи их в систему передачи и обработки данных. Средой передачи данных может быть WI-FI и проводное подключение к сети или устройству сбора данных. Поддержка различных производителей технических средств реализуется через использование необходимого устройств сбора данных. 

Система видео наблюдения - это набор камер видеонаблюдения и програмного обеспечения для передачи видеопотока в режиме реального времени в ИИ-систему мониторинга животных.

ИИ-система мониторинга животных - анализирует поток видео. Данная система предоставлена третьей стороной. Результатом анализа должны быть значения показателей: 
- кол-во признаков беспокойного поведения
- кол-во признаков задавливания поросят
- кол-во особей имеющих признаки нездорового поведения
- общее поголовье животных и отдельных видов
Эти результаты в виде структурированных сообщений, регулярно передаются в систему передачи и обработки данных (раз в 1 секунду или несколько секунд).
Физически система должна бать развернута на территории хозяйства и быть доступна в сети хозяйства. Такая реализация не зависит от связи платформы с ЦОДом компании.
Все необходимые данные после обработки системами аналитики и мониторинга будут отправлены в ЦОД системой синхронизации.


Система передачи и обработки данных - принимает сообщения от систем жизнеобеспечения и ИИ-системы. В качестве основного компонента решено использовать Apache Kafka.
Apache Kafka - разворачивается на стороне хозяйства и обеспечит быструю доставку сообщений в системы аналитики и мониторинга. 

Cистема мониторинга хозяйства -  в каждый момент времени получает метрические данные из системы передачи и обработки данных. Система обеспечивает взаимодействие с платформой пользователей через веб приложение или/и мобильное приложение, поддерживает разделение ролей, предоставляет доступ к показателям работы хозяйства, метрикам, отчетам. Система оповещает пользователя о критических значениях показателей. Все необходимые данные сохраняется в хранилище системы. 

Система синхронизации запрашивает данные из системы мониторинга готовые для передачи в систему сбора данных от хозяйств, проверят связь с системой сбора данных, отправляет данные, в случае сбоя повторяет отправку,пока не будет ответа о полученнии данных. 

АгроПром Х - Цифровая платформа обеспечивает сбор данных со всех хозяйств, физически находится удаленно от хозяйства. 

Важное требование к системе это реализация сбора данных о хозяйстве и сохранение их в центральном хранилище компании. Решение этого требования зависит от качества канала связи хозяйств и центров. Основное решение - использовать систему синхронизаци которая будет запрашивать данные для отправки из системы мониторинга и отправлять их в центр. Эта система выполняет роль верификатора отправки данных. Система мониторинга хозяйства специально готовит данные для отправки и хранит пока агент не подтвердит их отправку и данные могут быть удалены. Здесь очевидно увеличивается использование памяти в системе хранения, но значительное использование памяти возможно только при длительных обрывах связи. Главное отправлять данные быстрее чем готовить. Переданные данные на стороне платформы обрабатывает выделенный сервис.

Система жизнеобеспечения животных и ИИ-система отправляют структурированные сообщения (удовлетворяющие заранее описанной схеме), не нуждающиеся в детальной обработке. это снижает требования к производительности и к используемой памяти. В вышеуказанных системах могут использоваться EDGE устройства для реализации шлюзов в систему передачи данных. В частности для обработки данных с  разных устройств системы жизнеобеспечения могут быть реализованы драйверы для шлюза. Таким образом система передачи данных не зависит от технической реализации вышеописанных систем. 

Физически системы мониторинга, передачи данных работают на одном сервере тем самым будут разделять физичекую память это положительно влияет на скорость обработки данных и передачи данных между этими системы.

**Резюме**
Использование брокера соообщений позвоялет без сложностей увеличивать количество систем которые могут передавать данные для анализа. Система мониторинга включает в себя отдельные микросервисы реализующие анализ, отчетность, мониторинг и оповещение пользователей использующих общую БД. Для расширения возможностей системы необходимо добавить новый микросервис для анализа новых данных или расширить существующие микросервисы добавив новые правила в бизнес логику. Реализация нефункционального требования 2   

Использование брокера сообщений на стороне хозяйства защищает работу платформы от проблем со связью с центральным сервером и реализует нефункциональное требование 3.

Реализация системы мониторинга хозяйства с брокером сообщений на одном сервере и использование общей памяти позволяет обрабатывать отклики от ИИ-системыы с высокой скоростью. Нефункциональное требование 4.

Наличие систем синхронизации гарантирует передачу данных в центр вне зависимости от состояния канал связи. Система следит за его состоянием и отправляет данные с подтверждением получения, для этого на стороне центра развернута система сбора данных от хозяйств. Система сбора не зависит от количества хозяйств. Реализовано нефункциональное требование 5. 
В целом система имеет возможности по масштабируемости и отказоустойчивости так как  микросервисы системы монторинга и система синхронизации и брокер легко кластеризуются. 
Так же система независима от центрального сервера и независит от состояния серсвиса синхронизации. 
Может быть легко реплицирована на другие хозяйства. Правила синхронизации могут быть получены системой синхронизации так же из системы сбора данных.






