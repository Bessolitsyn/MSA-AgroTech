### <a name="_b7urdng99y53"></a>**Название задачи:** 
MVP архитектуры "платформа управления животноводческим комплексом"
### <a name="_hjk0fkfyohdk"></a>**Автор:**
Бессолицын Антон
### <a name="_uanumrh8zrui"></a>**Дата:**
24.07.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**
Система должна:
|**№**|**Требование**|
| :-: | :- |
|1|фиксировать признаки беспокойного поведения или драк среди животных и оповещать оператора;
|2|фиксировать признаки задавливания поросят;
|3|управлять кормушками и поилками разных производителей;
|4|оценивать состояние животных по внешнему виду и поведению: болезнь, гибель, беспокойство и так далее;
|5|следить за состоянием систем фильтрации воды;
|6|пересчитывать поголовье;
|7|следить за запасами еды и прогнозировать расход;
|8|делать пересчёт животных;
|9|поддерживать необходимое количество видеокамер для аналитики в реальном времени от разных производителей;
|10|быть построена по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью);
|11|предоставлять базовые метрики для передачи в другие системы;
|12|поддерживать возможность добавления собственных метрик;
|13|работать даже в случае отсутствия интернета и при необходимости отправлять уведомления дежурному сотруднику на местах мониторинга, а после восстановления связи синхронизироваться с центральной системой;
|14|иметь разделение ролей и поддерживать современные способы аутентификации и авторизации;
|15|иметь API для создания мобильного приложения или веб-приложения.

Варианты использования системы пользователем
|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|1|Любой сотрудник животноводческого комплекса, платформа |Использует веб приложение платформы.  | 1. Пользователь авторизуется на платформе 2. Платформа предоставляет UI, в зависимости от его роли и прав доступа пользователь видит состояние систем, сводку о поголовье животных, оповещения, прогноз расхода корма и воды и другие метрики  |
|2|платформа, ИИ-система мониторинга животных| потоковая передача видеоданнын |1. Платформав режиме real-time передает видео в ИИ-систему. 2. ИИ - система анализирует поток | 3. Результаты анализа в виде потока сообщени отправляются в платформу|

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Система должна:
|**№**|**Требование**|
| :-: | :- |
|1|обеспечить достаточно высокую отказоустойчивость 99,95%;|
|2|возможность расширения, то есть иметь возможность разработать новый функционал без изменений существующего;|
|3|высокая производительность — от момента возникновения нештатной ситуации, зафиксированной с помощью видеоаналитики, должно проходить не более 5 секунд до момента оповещения;|
|4|Система видеоаналитики должна реагировать в реальном времени (миллисекунды).|
|5|Построить платформу по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью); |
### <a name="_qmphm5d6rvi3"></a>**Решение**
Данный документ является результатом поиска архитектурного решения согласно описанным требованиям.
Описание вариантов задокументированы в документах [ADR-C1](../TASK1/ADR-С1.md) и [ADR-C2](../TASK2/ADR-С2.md) и дополнены диаграммами.
Вариант 1 решения
- [диаграмма контекста](../Task1/agrotech_v1_С1.puml) 
- [диаграмма контейнеров](../Task2/agrotech_v1_С1.puml) 
- [диаграмма компонентов](../Task3/agrotech_v1_С3.puml) 
- [диаграмма классов](../Task3/agrotech_v1_С4.puml) 

Вариант 2 решения:
- [диаграмма контекста](../Task1/agrotech_v2_С1.puml) 
- [диаграмма контейнеров](../Task2/agrotech_v2_С2.puml) 
- [диаграмма компонентов](../Task3/agrotech_v2_С3.puml) 
- [диаграмма классов](../Task3/agrotech_v2_С4.puml) 

**Сравнение вариантов**

Соответствие функциональным требованиям:
|**№**|**Требование**| Вариант 1 | Вариант 2 |
| :-: | :- | :- | :- |
|1|фиксировать признаки беспокойного поведения или драк среди животных и оповещать оператора; | + | + |
|2|фиксировать признаки задавливания поросят; | + | + |
|3|управлять кормушками и поилками разных производителей; | + | + |
|4|оценивать состояние животных по внешнему виду и поведению: болезнь, гибель, беспокойство и так далее; | + | + |
|5|следить за состоянием систем фильтрации воды; | + | + |
|6|пересчитывать поголовье; | + | + |
|7|следить за запасами еды и прогнозировать расход; | + | + |
|8|делать пересчёт животных; | + | + |
|9|поддерживать необходимое количество видеокамер для аналитики в реальном времени от разных производителей; | + | + |
|10|быть построена по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью); | + | - |
|11|предоставлять базовые метрики для передачи в другие системы; | + | + |
|12|поддерживать возможность добавления собственных метрик; | + | + |
|13|работать даже в случае отсутствия интернета и при необходимости отправлять уведомления дежурному сотруднику на местах мониторинга, а после восстановления связи синхронизироваться с центральной системой; | + | - |
|14|иметь разделение ролей и поддерживать современные способы аутентификации и авторизации; | + | + |
|15|иметь API для создания мобильного приложения или веб-приложения. | + | + |
| | | | 

Соответствие нефункциональным требованиям:


|**№**|**Нефункциональное требование**| Вариант 1 | Вариант 2 |
| :-: | :- | :- | :- |
|1|обеспечить достаточно высокую отказоустойчивость 99,95%;| ? | ? |
|2|возможность расширения, то есть иметь возможность разработать новый функционал без изменений существующего;| + | +|
|3|высокая производительность — от момента возникновения нештатной ситуации, зафиксированной с помощью видеоаналитики, должно проходить не более 5 секунд до момента оповещения;| + | - |
|4|Система видеоаналитики должна реагировать в реальном времени (миллисекунды).| + | - |
|5|Построить платформу по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью); | + | - | 
| | | | 

**Вывод**

Вариант 1 соответсвует всем требованиям и принимается как основной.
[диаграмма контекста](../Task1/agrotech_v1_С1.puml) 

### <a name="_bjrr7veeh80c"></a>**Альтернативы**

Вариант 2 не соответствует функциональным требованиям: 10, 13

Технически требованию 10 вариант соответвует, но вслучае такой задержки невозможна реализация требования 13. 

Выполнение требования 13 под большим вопросом поскольку нагрузка на канал связи весьма велика - поток видео с нескольких десятков камер должен быть обработан в режиме real-time это приближенно 10камер*1МБ/с(при 1080p HD, 30 кадров в секунду размер одной секунды видео)=10Мб/с=100мбит/с. Такой канал должен быть от одной фермы к ЦОДу. Даже если и обеспечить такой канал задача весьма посильная, то в случае 10 ферм и более на поддержание непрерывной работы 10 систем, ЦОД должен иметь канал 1гбит/с и более. Такое не выполнимо на данный момент.  

Вариант 2 не соответствует нефункциональным требованиям: 3, 4 по причине невозможности обеспечить достаточную пропускную способность канала передачи данных к ИИ-системе

**Недостатки, ограничения, риски**
 Производительные возможности сервера на котором будет развернута система напрямую зависят на производительность платформы. Важно правильно подобрать необходимое оборудование  

**Резюме**

Использование брокера соообщений позволяет без сложностей увеличивать количество систем которые могут передавать данные для анализа. Система мониторинга включает в себя отдельные микросервисы реализующие анализ, отчетность, мониторинг и оповещение пользователей использующих общую БД. Для расширения возможностей системы необходимо добавить новый микросервис для анализа новых данных или расширить существующие микросервисы добавив новые правила в бизнес логику. Реализация нефункционального требования 2   

Использование брокера сообщений на стороне хозяйства защищает работу платформы от проблем со связью с центральным сервером и реализует нефункциональное требование 3.

Реализация системы мониторинга хозяйства с брокером сообщений на одном сервере и использование общей памяти позволяет обрабатывать отклики от ИИ-системыы с высокой скоростью. Нефункциональное требование 4.

Наличие систем синхронизации гарантирует передачу данных в центр вне зависимости от состояния канал связи. Система следит за его состоянием и отправляет данные с подтверждением получения, для этого на стороне центра развернута система сбора данных от хозяйств. Система сбора не зависит от количества хозяйств. Реализовано нефункциональное требование 5. 
В целом система имеет возможности по масштабируемости и отказоустойчивости так как  микросервисы системы монторинга и система синхронизации и брокер легко кластеризуются. 
Так же система независима от центрального сервера и независит от состояния серсвиса синхронизации. 
Может быть легко реплицирована на другие хозяйства. Правила синхронизации могут быть получены системой синхронизации так же из системы сбора данных.








