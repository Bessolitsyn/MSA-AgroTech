### <a name="_b7urdng99y53"></a>**Название задачи:** 
MVP архитектуры "платформа управления животноводческим комплексом"
### <a name="_hjk0fkfyohdk"></a>**Автор:**
Бессолицын Антон
### <a name="_uanumrh8zrui"></a>**Дата:**
24.07.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

Система должна:
|**№**|**Требование**|
| :-: | :- |
|1|фиксировать признаки беспокойного поведения или драк среди животных и оповещать оператора;
|2|фиксировать признаки задавливания поросят;
|3|управлять кормушками и поилками разных производителей;
|4|оценивать состояние животных по внешнему виду и поведению: болезнь, гибель, беспокойство и так далее;
|5|следить за состоянием систем фильтрации воды;
|6|пересчитывать поголовье;
|7|следить за запасами еды и прогнозировать расход;
|8|делать пересчёт животных;
|9|поддерживать необходимое количество видеокамер для аналитики в реальном времени от разных производителей;
|10|быть построена по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью);
|11|предоставлять базовые метрики для передачи в другие системы;
|12|поддерживать возможность добавления собственных метрик;
|13|работать даже в случае отсутствия интернета и при необходимости отправлять уведомления дежурному сотруднику на местах мониторинга, а после восстановления связи синхронизироваться с центральной системой;
|14|иметь разделение ролей и поддерживать современные способы аутентификации и авторизации;
|15|иметь API для создания мобильного приложения или веб-приложения.

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|1|Любой сотрудник животноводческого комплекса, платформа |Использует веб приложение платформы.  | 1. Пользователь авторизуется на платформе 2. Платформа предоставляет UI, в зависимости от его роли и прав доступа пользователь видит состояние систем, сводку о поголовье животных, оповещения, прогноз расхода корма и воды и другие метрики  |
|2|платформа, ИИ-система мониторинга животных| потоковая передача видеоданнын |1. Платформав режиме real-time передает видео в ИИ-систему. 2. ИИ - система анализирует поток | 3. Результаты анализа регулярно отправляются в платформу|

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Система должна:
|**№**|**Требование**|
| :-: | :- |
|1|обеспечить достаточно высокую отказоустойчивость 99,95%;|
|2|возможность расширения, то есть иметь возможность разработать новый функционал без изменений существующего;|
|3|высокая производительность — от момента возникновения нештатной ситуации, зафиксированной с помощью видеоаналитики, должно проходить не более 5 секунд до момента оповещения;|
|4|Система видеоаналитики должна реагировать в реальном времени (миллисекунды).|
|5|Построить платформу по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью); |
### <a name="_qmphm5d6rvi3"></a>**Решение**
Данный документ содержит возможные архитектурные решения для реализации MVP
Существует несколько вариантов, они представлены на контекстных диаграммах:
- [Вариант 1](agrotech_v1_С1.puml) 
- [Вариант 2](agrotech_v1_С2.puml) 

На диаграммах контекста показаны основные системы платформы.
В целом для двух вариантом общим является использование локальной системы сбора сообщений  от конечных устройств, так как невозможно гарантировать приемлемую связь с центральным офисом компании и использовать его шину данных.
Следующие системы платформы являются общими для этих вариантов:
1. Система жизнеобеспечения животных - на физическом уровне это все технические системы обспечивающие жизнедеятельность животных. Это могут быть поилки, кормилки средства подачи корма, хранения, подготовки воды. Каждое такое  средство должно быть способно передать информацию о своем состояни. Для приема сообщений от технических устройств необходимо расположить несколько устройств сбора данных и одно устройство шлюз для унификации формата сообщений от устройств и передачи их в систему передачи и обработки данных. Средой передачи данных может быть WI-FI и проводное подключение к сети или устройству сбора данных. Поддержка различных производителей технических средств реализуется через использование необходимого устройств сбора данных.

2. Система видео наблюдения - это набор камер видеонаблюдения и програмного обеспечения для передачи видеопотока в режиме реального времени в ИИ-систему мониторинга животных.

3. ИИ-система мониторинга животных - анализирует поток видео. Данная система предоставлена третьей стороной. Результатом анализа должны быть значения показателей: 
- кол-во признаков беспокойного поведения
- кол-во признаков задавливания поросят
- кол-во особей имеющих признаки нездорового поведения
- общее поголовье животных и отдельных видов

4. Система передачи и обработки данных - принимает сообщения от систем жизнеобеспечения и ИИ-системы.

5. Cистема мониторинга хозяйства -  в каждый момент времени получает метрические данные из системы передачи и обработки данных. Система обеспечивает взаимодействие с платформой пользователей через веб приложение или/и мобильное приложение, предоставляет визуализацию показателей хозяйства на основе  получаемых метрик. Формирование отчетов. Ситема оповещает пользователя о критических значениях показателей. Сохраняет данные в свое хранилище. 

Физически системы мониторинга, передачи данных работают на одном сервере тем самым будут разделять физичекую память это положительно влияет на скорость обработки данных и передачи данных между этими системы.

Система жизнеобеспечения животных и ИИ-система отправляют структурированные сообщения (удовлетворяющие заранее описанной схеме), не нуждающиеся в детальной обработке. это снижает требования к производительности и к используемой памяти. В вышеуказанных системах могут использоваться EDGE устройства для реализации шлюзов в систему передачи данных. В частности для обработки данных с  разных устройств системы жизнеобеспечения могут быть реализованы драйверы для шлюза. Таким образом система передачи данных не зависит от технической реализации вышеописанных систем. 

АгроПром Х - Цифровая платформа обеспечивает сбор данных со всех хозяйств, физически находится удаленно от хозяйства. 

***Вариант 1***

Помимо выше описаных систем вариант 1 имеет следующие системы:
- Система синхронизации обеспечивает передачу данных в ЦОД. 
- Система интеграции хозяйств - принимает данные от хозяйств и обспечивает передачу этих данные в хранилище компании.

***Вариант 2***

Вариант 2 не имеет дополнительных систем. Описание различий в таблице ниже

**Различие вариантов**
|Система |Вариант 1|Вариант 2|
| :- | :- |  :- |
| ИИ-система мониторинга животных| Локальное использование системы. Система развернута в каждом хозяйстве  |  Система развернута централизовано в ЦОДе компании, удалена от хозяйств |
|+   Достоинства: | большая скорость обработки данных и передачи в систему мониторинга; независимость от канала связи с ЦОД | простота обслуживания, система легкодоступна и развернута в более отказоустойчивой среде; более масштабируемая - физически доступны ресурсы ЦОДа|
|-   Недостатки: | масштабирование ограничено ресурсам сервера системы; сложность в обслуживании - необходимо обслуживать столько систем сколько хозяйств| скорость обработки данных меньше так как система удалена от источников данных; высокое требование к качеству канала связи для передачи потокового видео |
| Системы синхронизации и интеграции | Cистема апрашивает данные из системы мониторинга готовые для передачи в систему сбора данных от хозяйств, проверят связь с системой сбора данных, отправляет данные в систему интеграции, в случае сбоя повторяет отправку,пока не будет ответа о полученнии данных. | Функции передачи данных о хозяйстве в ЦОД компании возложены на систему мониторинга. Система мониторинга передает необходимые данные прямо в шину данных компании |
|+   Достоинства: | ответвенность за передачу данных лежит на двух системах независимо работающих от остальных; обеспечние гарантированности отправки данных за счет гибкой настройки систем; нет высоких требований к качеству канала связи | ресурсы на разработку этих систем могут быть использованы иначе, например на расширение системы монторинга; использование существующей шины данных компании, не нужно разрабтывать сервис интеграции|
|-   Недостатки: | дополнительные ресурсы на разработку | зависимость функции передачи данных от сервиса мониторинга и шины данных сторонней системы, необходимо согласование интеграций и тестирования; высокие требований к качеству канала связи|



Эти результаты в виде структурированных сообщений, регулярно передаются в систему передачи и обработки данных (раз в 1 секунду или несколько секунд).
Физически система должна бать развернута на террритории хозяйства и быть доступна в сети хозяйства   

**Недостатки, ограничения, риски**
Построение платформы как по второму и первому варианту предполагает использование локального сервера хозяйства. В таком случае должен иметь высокую отказоустойчивость и производительность для обработки потока данных. 


