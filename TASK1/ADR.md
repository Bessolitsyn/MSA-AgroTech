### <a name="_b7urdng99y53"></a>**Название задачи:** 
MVP архитектуры "платформа управления животноводческим комплексом"
### <a name="_hjk0fkfyohdk"></a>**Автор:**
### <a name="_uanumrh8zrui"></a>**Дата:**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

|**№**|**Требование**|
| :-: | :- |
|1|фиксировать признаки беспокойного поведения или драк среди животных и оповещать оператора;
|2|фиксировать признаки задавливания поросят;
|3|управлять кормушками и поилками разных производителей;
|4|оценивать состояние животных по внешнему виду и поведению: болезнь, гибель, беспокойство и так далее;
|5|следить за состоянием систем фильтрации воды;
|6|пересчитывать поголовье;
|7|следить за запасами еды и прогнозировать расход;
|8|делать пересчёт животных;
|9|поддерживать необходимое количество видеокамер для аналитики в реальном времени от разных производителей;
|10|быть построена по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью);
|11|предоставлять базовые метрики для передачи в другие системы;
|12|поддерживать возможность добавления собственных метрик;
|13|работать даже в случае отсутствия интернета и при необходимости отправлять уведомления дежурному сотруднику на местах мониторинга, а после восстановления связи синхронизироваться с центральной системой;
|14|иметь разделение ролей и поддерживать современные способы аутентификации и авторизации;
|15|иметь API для создания мобильного приложения или веб-приложения.

Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием.

|**№**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- |
|1|Любой сотрудник животноводческого комплекса, платформа |Использует веб приложение платформы.  | 1. Пользователь авторизуется на платформе 2. Платформа предоставляет UI, в зависимости от его роли и прав доступа пользователь видит состояние систем, сводку о поголовье животных, оповещения, прогноз расхода корма и воды и другие метрики  |
|2|платформа, ИИ-система мониторинга животных| потоковая передача видеоданнын |1. Платформав режиме real-time передает видео в ИИ-систему. 2. ИИ - система анализирует поток | 3. Результаты анализа регулярно отправляются в платформу|

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Опишите здесь нефункциональные требования и архитектурно значимые требования.

|**№**|**Требование**|
| :-: | :- |
|1|обеспечить достаточно высокую отказоустойчивость 99,95%;|
|2|возможность расширения, то есть иметь возможность разработать новый функционал без изменений существующего;|
|3|высокая производительность — от момента возникновения нештатной ситуации, зафиксированной с помощью видеоаналитики, должно проходить не более 5 секунд до момента оповещения;|
|4|Система видеоаналитики должна реагировать в реальном времени (миллисекунды).|
|5|Построить платформу по принципу «центральный сервер — агенты» на конкретных фермах без ограничения количества таких агентов (в синхронизации между агентами и центральным сервером допускается задержка до 10 минут без учёта проблем со связью); |
### <a name="_qmphm5d6rvi3"></a>**Решение**
[Основная диаграмма контекста](agrotech_v1_С1.puml) 

На диаграмме контекста показаны основные системы платформы.

Система жизнеобеспечения животных - на физическом уровне это все технические системы обспечивающие жизнедеятельность животных. Это могут быть поилки, кормилки средства подачи корма, хранения, подготовки воды. Каждое такое  средство должно быть способно передать информацию о своем состояни. Для приема сообщений от технических устройств необходимо расположить несколько устройств сбора данных и одно устройство шлюз для унификации формата сообщений от устройств и передачи их в систему передачи и обработки данных. Средой передачи данных может быть WI-FI и проводное подключение к сети или устройству сбора данных. Поддержка различных производителей технических средств реализуется через использование необходимого устройств сбора данных.

Система видео наблюдения - это набор камер видеонаблюдения и програмного обеспечения для передачи видеопотока в режиме реального времени в ИИ-систему мониторинга животных.

ИИ-система мониторинга животных - анализирует поток видео. Данная система предоставлена третьей стороной. Результатом анализа должны быть значения показателей: 
- кол-во признаков беспокойного поведения
- кол-во признаков задавливания поросят
- кол-во особей имеющих признаки нездорового поведения
- общее поголовье животных и отдельных видов
Эти результаты в виде структурированных сообщений, регулярно передаются в систему передачи и обработки данных (раз в 1 секунду или несколько секунд).
Физически система должна бать развернута на террритории хозяйства и быть доступна в сети хозяйства     

Система передачи и обработки данных - принимает сообщения от систем жизнеобеспечения и ИИ-системы сохраняет эти данные в хранилище, удаляет устаревшие данные. 

Cистема мониторинга хозяйства -  в каждый момент времени получает метрические данные из системы передачи и обработки данных. Система обеспечивает взаимодействие с платформой пользователей через веб приложение или/и мобильное приложение, предоставляет визуализацию показателей хозяйства на основе  получаемых метрик. Формирование отчетов. Ситема оповещает пользователя о критических значениях показателей.


Агент запрашивает данные из системы передачи и обработки данных готовые для передачи в систему сбора данных от хозяйств. Агент проверят связь с системой сбора данных, отправляет данные, в случае сбоя повторяет отправку,пока не будет ответа о полученнии данных.

Система сбора данных от хозяйств - физически находится удаленно от хозяйства. Обеспечивает сбор данных со всех хозяйств. является точкой входа в "АгроПром Х - Цифровая платформа" 

Важное требование к системе это реализация сбора данных о хозяйстве и сохранение их в ЦОДЕ компании "АгроТех Х". Решение этого требования зависит от качества каналы связи хозяйств и центров. Основное решение - использовать систему агент который будет запрашивать данные для отправки из системы обработки данных и отправлять их в центр. Агент выполняет роль верификатора отправки данных. Система обработки данных должна специально готовить данные для отправки и хранить пока агент не подтвердит их отправку и данные могут быть удалены. Здесь очевидно увеличивается использование памяти в системе хранения, но значительное использование памяти возможно только при длительных обрывах связи. Главное отпавлять данные быстрее чем готовить. На более низком уровне  это реализация паттерна "Transactional outbox".


В принятом варианте система жизнеобеспечения животных и ИИ-система отправляют структурированные сообщения (удовлетворяющие заранее описанной схеме), не нуждающиеся в детальной обработке. это снижает требования к производительности и к используемой памяти. В вышеуказанных системах могут использоваться EDGE устройства для реализации шлюзов в систему передачи данных. В частности для обработки данных с  разных устройств системы жизнеобеспечения могут быть реализованы драйверы для шлюза. Таким образом система передачи данных не зависит от технической реализации вышеописанных систем. 

Физически системы мониторинга , передачи данных  и агент будут работать на одном сервере тем самым будут разделять физичекую память это положительно влияет на скорость обработки данных и передачи данных между этими системы. Передав нагрузку обработки сырых данных с системы передачи на Edge-устройства, высвободим дополнительные ресурсы для этих систем


### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Альтернативное решение агентской системы представлено на [схеме] () - здесь агент не используется а данные из системы передачи и обработки данных сразу отправляются в систему сбора данных. 

На данном уровне еще нет выбраны средства взаимодействия систем, но сущесвующие средва не могу гарантировать получение данных в случае проблем с каналом связи или требуют дополнительных усилий в настройке и разработке систем платформы.
Возможность задержки 10 минут в обеспечении синхронизации позволяет всю реализацию инкапсулировать в системе агент, а систему передачи данных сделать независимой от удаленной системы сбора данных от хозяйств. Разделение ответсвенностей позволит упростить разработку отдельных систем.

На альтернативной [схеме] () Решено передавать сырые данных от систем жизнеобеспечения животных и ИИ-системы. В этом случае система обработки должна на своей стороне структурировать данные. в таком случае система попадает под зависимость от технических средств другой системы. Достоинство такого варинта в простоте технического обслуживания(нет необходимости обслуживать более сложные Edge устроойства) в том числе обеспечение отказоустойчивости. Все операции будут выполняться физически на одном сервере в одном месте. Но требования к производительности сервера возрастут.

**Недостатки, ограничения, риски**
Передав нагрузку обработки сырых данных с системы передачи на Edge-устройства (шлюз для сбора данныс с датчик и устройств системы жизнеобеспечения), мы увеличиваем их количество. И усложняем их техническое обслуживание. Вероято поддерживать отказоустойчивость на одном 

