Container### <a name="_b7urdng99y53"></a>**Название задачи:** 
Выбор технологий и сервисов для реализации системы 
### <a name="_hjk0fkfyohdk"></a>**Автор:**
Бессолицын Антон
### <a name="_uanumrh8zrui"></a>**Дата:**
29.07.2025
### <a name="_3bfxc9a45514"></a>**Принятые решения**
Архитектурное решение на контекстном уровне принято и предтставлено в [ADR-C1](../TASK1/ADR-С1.md)
[Основная диаграмма контекста](../TASK1/agrotech_v1_С1.puml) 

### <a name="_qmphm5d6rvi3"></a>**Решения по сервисам и технологиям**
Основное решение по сервисам в контейнерой диаграмме [C2](agrotech_v1_С2.puml)

Определены следующие сервисы:
- шлюз системы жизнеобеспеченияя животных - обеспечивает потоковую передачу унифицированных соообщений
- шлюз системы видеонаблюдения - обеспечивает потоковую передачу видео во внешнюю ИИ-систему 
- брокер сообщений(шина данных) - обеспечивает взаимодествие сервисов, обработку и хранение сообщений
- сервис мониторинга - обеспечивает обработку потоковых метрических данных, реализует бизнес-логику платформы   (генерация оповещений, уведомлений, сохранение в БД) 
- аналитический сервис - обеспечивает обработку потоковых метрических данных, реализует бизнес-логику платформы  (анализ событий, ежедневные отчеты о работе хозяйства отчеты потребления ресурсов, сохранение в БД)
- агент - сервис сбора данных находящихся в хранилище, реализует политику передачи данных о хозяйстве в центральное хранилище
- сервис сбора данных от хозяйств  - обрабатывает данные хозяйств? RESTful-сервис, точка входа в центральную систему компании 
- API сервис 

***Способы взаимодействия сервисов***

Шлюз системы видеонаблюдения осуществляет взаимодействие с ИИ-системой по средствам WebRTC.

Агент взаимодействует с сервисом сбора данных от хозяйств через его REST API.


Способы взаимодействия сервисов с брокером сообщений зависит от реализации брокера и рассмотрены ниже.


***Брокер сообщения***
Apache Kafka будет использоваться в качестве брокера сообщения.
- данная технология обеспечивает потоковую обработку данных от систем жизнеобеспечения и ИИ-сиcтемы. 
- относительно не требовательна к ресурсам, легко кластеризуется, не будет сложности в развертывании и эксплуатации в хозяйство.
- высокая скорость и количество обработки сообщений  
- возможность обеспечит гарантированность доставки сообщений и их хранение 

сервисы взаимодейтсвующие с брокером, используют протокол брокера


### <a name="_bjrr7veeh80c"></a>**Альтернативы**

RabbitMQ альтернативный брокер.  
[Альтернативная схема](agrotech_v2_С2.puml)
В таблице предоставленной нейросетью ниже сравнение брокеров.
|Критерий|RabbitMQ|Apache Kafka|
| :-: | :- | :- |
Тип системы	|Классический брокер сообщений (Message Broker)	|Распределённая |система потоковой обработки (Event Streaming Platform)
Архитектура	|Очереди (Queues) и Exchange (Pub-Sub)	|Журнал сообщений (Log-based) + партиции
Скорость	|~50K–100K сообщений/сек (на ноде)	|~1M+ сообщений/сек (в кластере)
Задержка	|Миллисекунды	|Десятки миллисекунд – секунды (из-за репликации)
Гарантии доставки	|Подтверждение (ACK), Dead Letter Queue	|Репликация, гарантия порядка в партиции
Хранение данных	|Удаление после обработки (если не настроено иное)	|Хранит сообщения долго (дни/недели)
Масштабируемость	|Вертикально (ноды) + кластер	|Горизонтально (партиции + брокеры)
Использование	|Задачи в реальном времени (RPC, таски)	|Потоковая аналитика, логгинг, Event Sourcing

RabbitMQ предоставляет, те же возможности что и Kafka. Но в нашем случае возможности Kafca по хранению и обработки сообщений являются причиной его выбора.
 
**Недостатки, ограничения, риски**
Использование брокера Kafka на стороне хозяйства усложняет поддержку системы. Повышает требования к отказоустойчивости центрального сервера

